<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>30秒 選択反応検査（スマホ対応版）</title>
<style>
  body { background:#0b1220; color:#eef; font-family:sans-serif; text-align:center; padding:20px; }
  #timer { font-size:28px; margin-top:8px; }
  #light {
    width:160px; height:160px; border-radius:50%; margin:20px auto;
    background:#333;
  }
  button { padding:14px; margin:6px; border-radius:8px; border:0; cursor:pointer; font-size:18px; }
  #score { margin-top:12px; font-weight:700; }
  .btn-row { display:flex; justify-content:center; gap:8px; flex-wrap:wrap; margin-top:12px; }
</style>
</head>
<body>
<h1>30秒 選択反応検査</h1>
<p>キー操作: F→赤　 J→橙　 K→緑<br>スマホは下のボタンで操作</p>

<div id="timer">30</div>
<div id="light"></div>

<button id="start">開始</button>
<button id="stop" disabled>中止</button>

<div id="score">正解: 0　誤答: 0</div>

<div class="btn-row">
  <button data-color="red">赤 (F)</button>
  <button data-color="orange">橙 (J)</button>
  <button data-color="green">緑 (K)</button>
</div>

<script>
(function(){
  const light = document.getElementById("light");
  const startBtn = document.getElementById("start");
  const stopBtn = document.getElementById("stop");
  const timerEl = document.getElementById("timer");
  const scoreEl = document.getElementById("score");
  const colorBtns = document.querySelectorAll(".btn-row button");

  const colors = ["red","orange","green"];
  const keyMap = { f:"red", j:"orange", k:"green" };

  let running=false, correct=0, wrong=0, timeLeft=30, currentColor=null, intervalId=null;

  function rnd(prev){
    let next;
    do {
      next = colors[Math.floor(Math.random()*colors.length)];
    } while(next === prev);
    return next;
  }

  function showColor(c){
    currentColor = c;
    if(!c){
      light.style.background="#333";
    } else if(c==="green"){
      light.style.background="#00d46a";
    } else if(c==="orange"){
      light.style.background="#ffa500"; // オレンジ寄り
    } else if(c==="red"){
      light.style.background="#ff453a";
    }
  }

  function updateScore(){ scoreEl.textContent = `正解: ${correct}　誤答: ${wrong}`; }

  function start(){
    if(running) return;
    running=true; correct=0; wrong=0; timeLeft=30;
    startBtn.disabled=true; stopBtn.disabled=false;
    showColor(rnd(null)); updateScore();
    timerEl.textContent = timeLeft;
    intervalId = setInterval(()=>{
      timeLeft--;
      timerEl.textContent = timeLeft;
      if(timeLeft<=0) end();
    },1000);
  }

  function end(){
    if(!running) return;
    running=false;
    clearInterval(intervalId);
    startBtn.disabled=false; stopBtn.disabled=true;
    timerEl.textContent = "終了";
    showColor(null);
  }

  function stop(){ end(); }

  function handleInput(color){
    if(!running) return;
    if(color === currentColor){
      correct++; updateScore(); showColor(rnd(currentColor));
    } else {
      wrong++; updateScore();
    }
  }

  window.addEventListener("keydown", e => {
    handleInput(keyMap[e.key.toLowerCase()]);
  });

  colorBtns.forEach(btn=>{
    btn.addEventListener("click", ()=>handleInput(btn.dataset.color));
  });

  startBtn.addEventListener("click", start);
  stopBtn.addEventListener("click", stop);
})();
</script>
</body>
</html>
